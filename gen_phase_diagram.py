import os
import numpy as np
# import numpy as np
import matplotlib.pyplot as plt
from sklearn.decomposition import PCA
from sklearn.manifold import TSNE
import matplotlib.patches as mpatches

phases = {}
phases['zero'] = [121, 141, 161, 181, 201, 221, 241, 261, 8041, 8061, 8081, 8101, 8121, 8141,
                  15941, 15961, 15981, 16001, 16021, 16041] + [i for i in range(23841, 23981, 20)] + \
                 [i for i in range(31761, 31881, 20)] + \
                 [i for i in range(39701, 39782, 20)] + \
                 [i for i in range(47641, 47702, 20)] + \
                 [55581, 55601, 55641, 63521, 71461, 79401]

phases['fm'] = [103361, 103381, 103401, 103421, 103441, 103461, 103481, 103501,
                103521, 103541, 103561, 103581, 103601, 111301, 111321, 111341,
                111361, 111381, 111401, 111421, 111441, 111461, 111481, 111501,
                111521, 111541, 119241, 119261, 119281, 119301, 119321, 119341,
                119361, 119381, 119401, 119421, 119441, 119461, 119481, 127181,
                127201, 127221, 127241, 127261, 127281, 127301, 127321, 127341,
                127361, 127381, 127401, 127421, 135121, 135141, 135161, 135181,
                135201, 135221, 135241, 135261, 135281, 135301, 135321, 135341,
                135361, 143061, 143081, 143101, 143121, 143141, 143161, 143181,
                143201, 143221, 143241, 143261, 143281, 143301, 151001, 151021,
                151041, 151061, 151081, 151101, 151121, 151141, 151161, 151181,
                151201, 151221, 151241, 16241, 16261, 24181, 24201, 32061,
                32081, 32101, 32141, 381, 39961, 39981, 40001, 40021,
                40041, 40061, 40081, 47901, 47921, 47941, 47961, 47981,
                48001, 48021, 55821, 55841, 55861, 55881, 55901, 55921,
                55941, 55961, 63661, 63681, 63701, 63741, 63781, 63801,
                63821, 63841, 63861, 63881, 63901, 71601, 71661, 71681,
                71701, 71721, 71741, 71761, 71781, 71801, 71821, 71841,
                79541, 79561, 79581, 79601, 79621, 79641, 79661, 79681,
                79701, 79721, 79741, 79761, 79781, 8301, 8321, 87481,
                87501, 87521, 87541, 87561, 87581, 87601, 87621, 87641,
                87661, 87681, 87701, 87721, 95421, 95441, 95461, 95481,
                95501, 95521, 95541, 95561, 95581, 95601, 95621, 95641,
                95661]

phases['af'] = [103221, 103241, 111161, 111181, 119101, 119121, 119141, 119161,
                127041, 127061, 134981, 135001, 135021, 142921, 142941, 150861,
                150881, 63541, 71481, 79421, 87341, 87361, 95281, 95301,
                95321]

phases['random'] = [1, 101, 15881, 15901, 15921, 21, 23821, 41, 55621,
                    61, 63561, 7941, 7961, 7981, 8001, 8021, 81]

# phases['vert'] = [103341, 111261, 135101, 150961, 281, 39801, 39841, 47741,
#                   47781, 55721, 71561, 79461, 79501, 87461]
# phases['hor'] = [103321, 111281, 119201, 119221, 127141, 127161, 135081, 143021,
#                  143041, 150941, 150981, 301, 31881, 321, 341, 361,
#                  39821, 47761, 55681, 55701, 63621, 63641, 71581, 79521,
#                  8241, 8261, 8281, 87441, 95381, 95401]

phases['hor_vert_dom'] = [281] + [301, 321, 341, 361, 8241, 8261, 8281]
phases['hor_vert_af'] = [103341, 111261, 135101, 150961, 39801, 39841, 47741,
                         47781, 55721, 71561, 79461, 79501, 87461] + \
                        [103321, 111281, 119201, 119221, 127141, 127161,
                         135081, 143021, 143041, 150941, 150981, 31881,
                         39821, 47761, 55681, 55701, 63621, 63641, 71581, 79521,
                         87441, 95381, 95401]

phases['diag'] = [16061, 16081, 16101, 16121, 23981, 24001, 24021, 24041, 24061,
                  24081, 31921, 31941, 31961, 31981, 32001, 32021, 39861, 39881, 39901, 39921, 39941, 47841, 47861,
                  55781, 55801, 63761, 8161, 8181]

# phases['wave'] = [111241, 119181, 127121, 135061, 143001,  16141,  16161,  16181,
#         16201,  16221,  24101,  24121,  24141,  24161,  31901,  32121,
#         47801,  47821,  55661,  55741,  55761,  71621,   8201,   8221,
#         87401]
# phases['domens'] = [32041, 47721, 47881, 63721, 71641]


phases['domen_waves'] = [111241, 119181, 127121, 135061, 143001, 16141, 16161, 16181,
                         16201, 16221, 24101, 24121, 24141, 24161, 31901, 32121,
                         47801, 47821, 55661, 55741, 55761, 71621, 8201, 8221,
                         87401] + [32041, 47721, 47881, 63721, 71641]

phases['squares'] = [103261, 103281, 103301, 111201, 111221, 127081, 127101, 135041,
                     142961, 142981, 150901, 150921, 63581, 63601, 71501, 71521,
                     71541, 79441, 79481, 87381, 87421, 95341, 95361]

colors_phase = {'zero': 'purple',
                'fm': 'yellow',
                'af': 'red',
                'random': 'grey',
                # 'vert': 'blue',
                # 'hor': 'green',
                'diag': 'orange',
                # 'wave': 'brown',
                'domen_waves': 'green',
                'hor_vert_dom': 'brown',
                'hor_vert_af': 'blue',
                # 'domens': 'darkblue',
                'squares': 'lime'
                }

dirData = 'large_nf_InvertZY2'
# newDir = os.path.join('.', 'large_tsne_paramsInvert')
newDir = os.path.join('.', 'large_nf_good_phases_diagram')
nset = 'large_set1'

if not os.path.exists(newDir):
    os.makedirs(newDir)
# nset = 'set1'

# nset = 'set' + str(nnset)
wData = np.genfromtxt(os.path.join('.', dirData, (nset + '_W' + '.dat')))
cntwj = wData.size
jData = np.genfromtxt(os.path.join('.', dirData, (nset + '_J' + '.dat')))
snz10 = np.genfromtxt(os.path.join('.', dirData, (nset + '_Z' + '.dat')))
snx10 = np.genfromtxt(os.path.join('.', dirData, (nset + '_X' + '.dat')))
sny10 = np.genfromtxt(os.path.join('.', dirData, (nset + '_Y' + '.dat')))
# sny10 = np.genfromtxt(os.path.join('.', dirData, (nset + '_Y' + '.dat')))

print(snx10.shape)

i = 0
j = 0
xData = snx10.copy()
yData = sny10.copy()
zData = snz10.copy()

snx10 = []
sny10 = []
snz10 = []
jData1 = []
wData1 = []
setni = []
set_dict = {}

for cur in range(397 * 397):
    if (i % 20 == 0 and j % 20 == 0):
        snx10.append(xData[cur])
        sny10.append(yData[cur])
        snz10.append(zData[cur])
        jData1.append(jData[cur])
        wData1.append(wData[cur])
        setni.append(cur + 1)
        set_dict[cur + 1] = len(jData1) - 1
    j = (j + 1) % 397
    if ((cur + 1) % 397 == 0):
        i += 1

jData = jData1.copy()
wData = wData1.copy()

print(set_dict)

cntwj = len(wData)
print(cntwj)

label = ['black' for i in range(cntwj)]
# s = []
# cur_col = 0
cncn = 0
legend = ["" for i in range(cntwj)]

for f_name in phases.keys():
    # cur_col += 1
    f_values = phases.get(f_name)
    cur_col = colors_phase.get(f_name)
    print(f_name, cur_col)
    # print(f_values)
    cncn += len(f_values)
    for i in f_values:
        label[set_dict[i]] = cur_col
        legend[set_dict[i]] = f_name
    # tsne_dots(f_name + suf, f_values)
# print(label)
for i in range(len(label)):
    if (label[i] == 'black'):
        print("black", i, setni[i])
# print(cncn)
# print()

plt.scatter(jData, wData, s=40, c=label,
            edgecolor='none', vmin=1, vmax=10)
# cmap=plt.cm.nipy_spectral)
# plt.colorbar()
# plt.legend()
# plt.
patches = [mpatches.Patch(color=colors_phase[phase], label=phase) for phase in colors_phase.keys()]

plt.xlabel("J (коэффициент связи между ячейками)")
plt.ylabel("W (параметр накачки)")


#прямые / квадраты
x1 = [0.36599999999999994, 0.36599999999999994, 0.3959999999999999, 0.4859999999999999, 0.4559999999999999, 0.4859999999999999]
y1 = [2.041309823756, 2.331486146188, 2.62166246862, 2.911838791052, 3.056926952268, 3.202015113484]
plt.plot(x1, y1)


#прямые/ферромагнетик
x2 = [0.9539999999999997, 0.8939999999999998, 0.8939999999999998, 0.8939999999999998, 0.9539999999999997, 0.9239999999999998, 0.9239999999999998, 0.9239999999999998, 0.8939999999999998, 0.9239999999999998]
y2 = [2.186397984972, 2.25894206558, 2.549118388012, 2.62166246862, 2.694206549228, 2.839294710444, 2.98438287166, 3.274559194092, 3.7823677583479998, 3.8549118389559998]
plt.plot(x2, y2)




#диагональ
x3 = [1.0919999999999996, 1.2419999999999998]
y3 = [0.508816120912, 0.726448362736]
plt.plot(x3, y3)

x5 = [1.0739999999999998, 1.0739999999999998, 1.0139999999999998]
y5 = [1.03476070532, 1.107304785928, 1.252392947144]
plt.plot(x5, y5)


#нулевая / антиферромагнетик
x4 = [0.08399999999999999, 0.08399999999999999, 0.14399999999999996, 0.29399999999999993]
y4 = [0.545088161216, 0.617632241824, 0.690176322432, 0.76272040304]
plt.plot(x4, y4)


#антиферромагнетик / квадраты
x7 = [0.22199999999999995, 0.16199999999999995, 0.22199999999999995, 0.16199999999999995, 0.16199999999999995, 0.37199999999999994, 0.3419999999999999, 0.19199999999999995, 0.16199999999999995]
y7 = [1.542569269576, 1.687657430792, 1.7602015114, 1.905289672616, 2.12292191444, 2.195465995048, 2.268010075656, 2.340554156264, 2.4130982368719995]

plt.plot(x7, y7)

x8 = [0.22199999999999995, 0.16199999999999995, 0.19199999999999995, 0.25199999999999995, 0.16199999999999995, 0.19199999999999995, 0.16199999999999995, 0.19199999999999995]
y8 = [2.340554156264, 2.4856423174799995, 2.5581863980879995, 2.7032745593039995, 2.8483627205199995, 3.0659949623439995, 3.2110831235599995, 3.3561712847759995]
plt.plot(x8, y8)


#низ феромагнетика

x6 = [2.2139999999999995, 2.1839999999999993]
y6 = [0.58136020152, 0.798992443344]
plt.plot(x6, y6)

x9 = [1.4039999999999997, 1.3139999999999996, 1.4639999999999995]
y9 = [1.4881612091199998, 1.7057934509439998, 1.7783375315519998]
plt.plot(x9, y9)


plt.ylim((0, 4))
plt.xlim((0, 2.5))

plt.show()




# plt.legend(handles=patches)
# plt.savefig(os.path.join(newDir,
#                          'my_no_legend_new_40.png'))
# plt.show()
